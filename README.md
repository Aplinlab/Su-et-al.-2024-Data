# License
Data and code repository for Su et al. 2024.
Copyright (C) 2024  Aplinlab.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.

Email: f.aplin@unsw.edu.au

# Files and Folders
## 1_main_analysis/
### 1_loading.jl
Loads raw data files collected using an INTAN RHS Stim-Recording System (saved in the .RHS format)
and converts relevant data into the .JLD2 format. Additional metadata is supplied in an Excel
spreadsheet. Note that this will not run without the raw data files, which have not been uploaded
due to excessive size.

### 2_template_generation.jl
Applies principal component analysis and k-means clustering to template files in order to produce
unit assignment templates for spikesorting. Template information, including cluster centres and
cluster sizes, are saved into /spikesorting_templates in the .JLD2 format. Note that this will not
run without the .JLD2 files produced by loading.jl, which have not been uploaded due to excessive
size.

### 3_spikesorting.jl
Sorts all data files into unit assignments using the previously determined templates. Sorted data
is saved into /spikesorted_data in the .JLD2 format. Note that this will not run without the
.JLD2 files produced by loading.jl, which have not been uploaded due to excessive size.

### 4a_csv_export.jl
Counts spike events within supplied windows and exports counts, alongside simple statistics such as
standard deviations as well as file metadata, to the .CSV format for further analysis in R. This
script will run with the files included in this repository.

### 4b_csv_export_sustained-thermal-response.jl
A fork of csv_export.jl which uses window timings for the sustained thermal response and ignores
non-thermal-dominant units.

### r_analysis/
This folder contains the .RMD file used for statistical analysis of the main results, primarily
through the use of linear mixed-effects regressions. Also found here are the full_results .CSVs
generated by csv_export.jl and csv_export_sustained-thermal-response.jl, as well as the following
subfolders:

- **data_subsets/** contains subsets of 'full_results 2024-02-12.csv' showing what was used for
specific portions of the statistical analysis.
- **misc_statistics/** contains some descriptive statistics taken from the R analysis.

## 2_non_evoked_activity_analysis
### 1_loading_non-evoked-response.jl
A fork of loading.jl which reads and converts the pre-stimulus portions of recorded data.

### 2_csv_export_non-evoked-response.jl
A fork of csv_export.jl to count spike events in the outputs of loading_non-evoked-response.jl.

### full_results non-evoked-response 2024-02-14.csv
The .CSV file generated by csv_export_non-evoked-response.jl, containing data such as spike counts,
spike frequencies, and file metadata.

### non-evoked-activity_r_analysis.rmd
Plots spike rates for non-evoked activity against various conditions and performs statistical
analysis of the data using a linear mixed-effects regression.

### data_subsets
This folder contains spike frequency data from 'full_results non-evoked-response 2024-02-14.csv',
separated into the analysed conditions and with metadata stripped. These spreadsheets were used to
generate supplementary figure S4.

## 3_spike_timing_analysis
### get_spike_timings.jl
Exports the time relative to stimulus trigger of every spike present in the recorded data, using
the files created by loading.jl in the main_analysis section.

### spike-timing_r_analysis.rmd
Plots binned spike timing data and determines suitable boundaries for the windows used in the main
analysis.

### spike_timings 2024-02-14.csv
The .CSV file generated by get_spike_timings.jl, containing every the timestamp in samples of every
spike event sorted by stimulus type.

### spike_timing_histogram_[stimulus].csv
The data from 'spike_timings 2024-02-14.csv' sorted into bins. These spreadsheets are the input for
spike-timing_r_analysis.rmd.

## 4_tactile_latency_analysis
### tactile_latency.jl
Sorts spike events from .JLD2 files in spikesorted_data into bins, and outputs a .CSV containing
the latency of the largest bin in milliseconds.

### tactile_evoked_units.csv
A subset of 'full_results 2024-02-12.csv' containing data from evoked tactile-dominant units only.
This file is used to determine which units to analyse in tactile_latency.jl.

### tactile_peak_latencies.csv
The .CSV file generated by tactile_latency.jl. Contains the latency of the response peak for each
evoked tactile-dominant unit in milliseconds.

## error_logs
Logs for some unfixed errors which were discovered during the late stages of the pipeline and only
affected a small number of units.

## spikesorted_data
Data saved from spikesorting.jl in a .JLD2 format. Used as input in csv_export.jl.

## spikesorting_templates
Template data saved from template_generation.jl in a .JLD2 format. Used as input in spikesorting.jl.

### src
Source files containing functions used throughout the .JL scripts.

## package_installer.jl
Installs all packages used throughout the .JL scripts.

## saved_files_info.xlsx
Metadata regarding .JLD2 files at various stages of the pipeline. Some internal notes made during
analysis are present.